# üìã S1-002: Dev-—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —Ç–∞ –ª—ñ–Ω—Ç–∏–Ω–≥

## –ú–µ—Ç–∞

–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —è–∫–æ—Å—Ç—ñ –∫–æ–¥—É —Ç–∞–∫, —â–æ–± —î–¥–∏–Ω–∏–π —Å—Ç–∏–ª—å –∫–æ–¥—É –∑–∞–±–µ–∑–ø–µ—á—É–≤–∞–≤—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑ –ø–µ—Ä—à–æ–≥–æ –∫–æ–º—ñ—Ç—É. –ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è ‚Äî pre-commit hooks –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å –∫–æ–¥ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –∫–æ–º—ñ—Ç—ñ, –∞ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫ –±–∞—á–∏—Ç—å –ø–æ–º–∏–ª–∫–∏ –≤ IDE —â–µ –¥–æ –∫–æ–º—ñ—Ç—É.

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ S1-001 (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π —Å—Ç–≤–æ—Ä–µ–Ω–æ, pyproject.toml –º—ñ—Å—Ç–∏—Ç—å ruff/mypy/pytest –≤ dev-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è—Ö). –¶—è –∑–∞–¥–∞—á–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä—É—î —ó—Ö –¥–µ—Ç–∞–ª—å–Ω–æ —Ç–∞ –¥–æ–¥–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—é —á–µ—Ä–µ–∑ pre-commit.

---

## Acceptance Criteria

- [x] `uv run ruff check .` –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –Ω–∞ –≤—Å—å–æ–º—É codebase –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- [x] `uv run ruff format --check .` –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –±–µ–∑ –∑–º—ñ–Ω
- [x] `uv run mypy src/` –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –≤ strict mode
- [x] `pre-commit install` –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î hooks
- [x] `pre-commit run --all-files` –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- [x] Makefile –º—ñ—Å—Ç–∏—Ç—å –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è —Ç–∏–ø–æ–≤–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π

---

## –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è ruff

–í `pyproject.toml` (—Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –±–∞–∑–æ–≤–æ—ó –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∑ S1-001):

```toml
[tool.ruff]
target-version = "py313"
line-length = 88
src = ["src"]

[tool.ruff.lint]
select = [
    "E",      # pycodestyle errors
    "W",      # pycodestyle warnings
    "F",      # pyflakes
    "I",      # isort
    "N",      # pep8-naming
    "UP",     # pyupgrade
    "B",      # flake8-bugbear
    "SIM",    # flake8-simplify
    "RUF",    # ruff-specific
    "ASYNC",  # flake8-async ‚Äî –≤–∞–∂–ª–∏–≤–æ –¥–ª—è asyncio codebase
    "S",      # flake8-bandit (security)
    "PTH",    # flake8-use-pathlib
    "T20",    # flake8-print (–∑–∞–±–æ—Ä–æ–Ω—è—î–º–æ print, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ structlog)
]
ignore = [
    "S101",   # assert –≤ —Ç–µ—Å—Ç–∞—Ö ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ
]

[tool.ruff.lint.per-file-ignores]
"tests/**/*.py" = ["S101", "S106", "T20"]  # assert, hardcoded passwords —Ç–∞ print –¥–æ–∑–≤–æ–ª–µ–Ω—ñ –≤ —Ç–µ—Å—Ç–∞—Ö
# Alembic autogenerated migrations ‚Äî relaxed linting.
"migrations/versions/*.py" = ["E501", "UP007", "UP035", "I001", "RUF100", "W291"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
```

### –ß–æ–º—É —Ü—ñ –ø—Ä–∞–≤–∏–ª–∞

- **ASYNC** ‚Äî –ø—Ä–æ—î–∫—Ç –ø–æ–≤–Ω—ñ—Å—Ç—é async (FastAPI + psycopg v3 async + async LLM SDK). –õ–æ–≤–∏—Ç—å —Ç–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏: blocking calls –≤ async, –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ await.
- **S (bandit)** ‚Äî security baseline: hardcoded passwords, SQL injection patterns, unsafe deserialization.
- **T20** ‚Äî –∑–∞–±–æ—Ä–æ–Ω—è—î `print()` –Ω–∞ –∫–æ—Ä–∏—Å—Ç—å structlog. –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–±—É—Ç–æ–º—É debug-print.
- **PTH** ‚Äî pathlib –∑–∞–º—ñ—Å—Ç—å os.path. –°—É—á–∞—Å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è Python 3.13+.

---

## –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è mypy

```toml
[tool.mypy]
python_version = "3.13"
strict = true
plugins = ["pydantic.mypy"]
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true

[[tool.mypy.overrides]]
module = "trafilatura.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "pptx.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "docx.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "fitz.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "whisper.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "pgvector.*"
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = "uuid_utils.*"
ignore_missing_imports = true
```

### –ß–æ–º—É overrides

–î–µ—è–∫—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ (trafilatura, python-pptx, python-docx, PyMuPDF, whisper) –Ω–µ –º–∞—é—Ç—å py.typed –∞–±–æ —Å—Ç–∞–±—ñ–≤. –ó–∞–º—ñ—Å—Ç—å `ignore_missing_imports = true` –≥–ª–æ–±–∞–ª—å–Ω–æ ‚Äî —ñ–≥–Ω–æ—Ä—É—î–º–æ —Ç–æ—á–∫–æ–≤–æ, —â–æ–± –¥–ª—è —Ä–µ—à—Ç–∏ –∫–æ–¥—É strict mode –ø—Ä–∞—Ü—é–≤–∞–≤ –ø–æ–≤–Ω—ñ—Å—Ç—é.

---

## Pre-commit –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### .pre-commit-config.yaml

```yaml
repos:
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.15.0
    hooks:
      - id: ruff
        args: [--fix]
      - id: ruff-format

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.19.1
    hooks:
      - id: mypy
        additional_dependencies:
          - pydantic>=2.12
          - pydantic-settings>=2.12
          - sqlalchemy[asyncio]>=2.0.37
          - pgvector>=0.4
          - uuid-utils>=0.9
        args: [--config-file=pyproject.toml]
        pass_filenames: false
        entry: mypy src/

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-toml
      - id: check-added-large-files
        args: [--maxkb=500]
      - id: debug-statements
```

> **–ü—Ä–∏–º—ñ—Ç–∫–∞:** –í–µ—Ä—Å—ñ—ó –æ–Ω–æ–≤–ª–µ–Ω—ñ –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö —Å—Ç–∞–Ω–æ–º –Ω–∞ –ª—é—Ç–∏–π 2026: ruff v0.15.0, mypy v1.19.1, pre-commit-hooks v6.0.0.

---

## Makefile

```makefile
.PHONY: help install lint format typecheck test test-cov check all

help:  ## –ü–æ–∫–∞–∑–∞—Ç–∏ —Ü—é –¥–æ–≤—ñ–¥–∫—É
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | \
		awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-15s\033[0m %s\n", $$1, $$2}'

install:  ## –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —Ç–∞ pre-commit hooks
	uv sync
	uv run pre-commit install

lint:  ## –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ–¥ (ruff)
	uv run ruff check src/ tests/

format:  ## –§–æ—Ä–º–∞—Ç—É–≤–∞—Ç–∏ –∫–æ–¥ (ruff)
	uv run ruff format src/ tests/
	uv run ruff check --fix src/ tests/

typecheck:  ## –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç–∏–ø–∏ (mypy)
	uv run mypy src/

test:  ## –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏
	uv run pytest || test $$? -eq 5

test-cov:  ## –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏ –∑ coverage
	uv run pytest --cov --cov-report=term-missing || test $$? -eq 5

check: lint typecheck test  ## –ü–æ–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ (lint + types + tests)

all: format check  ## –§–æ—Ä–º–∞—Ç—É–≤–∞—Ç–∏ + –ø–æ–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
```

---

## –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≥–ª—É—à–æ–∫ –¥–ª—è mypy strict

–£—Å—ñ –º–æ–¥—É–ª—ñ-–∑–∞–≥–ª—É—à–∫–∏ –∑ S1-001 –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–≤–µ—Å—Ç–∏ –¥–æ —Å—Ç–∞–Ω—É, —â–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å `mypy --strict`. –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —à–∞–±–ª–æ–Ω:

```python
"""<Module description>. TODO: implement in S1-0XX."""
```

–ü–æ—Ä–æ–∂–Ω—ñ `__init__.py` –ø—Ä–æ—Ö–æ–¥—è—Ç—å strict –±–µ–∑ –∑–º—ñ–Ω. –§–∞–π–ª–∏ –∑ –∫–æ–¥–æ–º (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `config.py`) –ø–æ–≤–∏–Ω–Ω—ñ –º–∞—Ç–∏ –∞–Ω–æ—Ç–∞—Ü—ñ—ó —Ç–∏–ø—ñ–≤ –Ω–∞–≤—ñ—Ç—å —É –∑–∞–≥–ª—É—à–∫–∞—Ö.

---

## –ö—Ä–æ–∫–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

1. –†–æ–∑—à–∏—Ä–∏—Ç–∏ ruff –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –≤ `pyproject.toml` (–¥–æ–¥–∞—Ç–∏ ASYNC, S, PTH, T20, per-file-ignores)
2. –î–æ–¥–∞—Ç–∏ mypy overrides –¥–ª—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –±–µ–∑ type stubs
3. –°—Ç–≤–æ—Ä–∏—Ç–∏ `.pre-commit-config.yaml`
4. –°—Ç–≤–æ—Ä–∏—Ç–∏ `Makefile`
5. `uv run pre-commit install`
6. `uv run pre-commit run --all-files` ‚Äî –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—å, —â–æ –≤—Å–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å
7. –í–∏–ø—Ä–∞–≤–∏—Ç–∏ –≤—Å—ñ warning/error —É –∑–∞–≥–ª—É—à–∫–∞—Ö, —è–∫—â–æ —î
8. `make check` ‚Äî —Ñ—ñ–Ω–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
9. Commit + push

---

## –ü—Ä–∏–º—ñ—Ç–∫–∏

- `ruff` –∑–∞–º—ñ–Ω—é—î flake8, isort, pyupgrade, bandit ‚Äî –æ–¥–∏–Ω —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑–∞–º—ñ—Å—Ç—å –ø'—è—Ç–∏.
- pre-commit hooks –∑–∞–ø—É—Å–∫–∞—é—Ç—å ruff –∑ `--fix` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–ø—Ä–∞–≤–ª—è—î —Ç–µ, —â–æ –º–æ–∂–µ (—Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è —ñ–º–ø–æ—Ä—Ç—ñ–≤, –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏—Ö import).
- mypy –≤ pre-commit –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –Ω–∞ –≤—Å—å–æ–º—É `src/`, –Ω–µ –Ω–∞ –æ–∫—Ä–µ–º–∏—Ö —Ñ–∞–π–ª–∞—Ö ‚Äî —ñ–Ω–∞–∫—à–µ –Ω–µ –ø—Ä–∞—Ü—é—î cross-module type checking.
- `check-added-large-files` –∑ –ª—ñ–º—ñ—Ç–æ–º 500KB ‚Äî –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ –∫–æ–º—ñ—Ç—É –≤—ñ–¥–µ–æ/–º–æ–¥–µ–ª–µ–π.
